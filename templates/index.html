<!--Template for Calculating-->

{% extends "layout.html" %} {% block title %} Home {% endblock %} {% block main %}

<h2 style="margin-bottom: 1rem;"> Calculate How Much You Could've Saved! </h2>
<div class="container-fluid">

    <form action="/" method="post" class="needs-validation" novalidate>

        <div class="form-group">
            <select name="make" class="form-control" id="validationCustom04" required>
                <option style="text-align: center;" disabled="" value="" selected="">Make</option>
                {% for name in make %}
                <option style="text-align: center;" value="{{ name }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <select name="model" class="form-control" id="validationCustom04" required>
                <option disabled="" value="" selected="">Model</option>
                {% for name in model %}
                <option value="{{ name }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <select name="year" class="form-control" id="validationCustom04" required>
                <option disabled="" value="" selected="">Year</option>
                {% for name in year %}
                <option value="{{ name }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">

            <div id="accordion">
                <a class="btn btn-primary" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"
                    id="headingOne" style="color:white;">Input Miles</a>
                <a class="btn btn-primary" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo"
                    id="headingTwo" style="color:white;">Input Locations</a>
                <a class="btn btn-primary" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree"
                    id="headingThree" style="color:white;">Auto GPS</a>
                <div class="form-group" style="margin-top:1rem;">
                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                        <input class="form-control" name="miles" id="validationCustom04" placeholder="Miles Travelled" type="text" value="" required>
                    </div>
                    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                        <div class="form-group">
                            <input class="form-control" name="startqi" id="startqi" type="text" value="" style="display:none;">
                            <input class="form-control" name="start" id="startq" placeholder="Start Location" type="text" value="" required>
                            <div id="result" style="display:flex; flex-direction:column; margin:auto; z-index: 1; max-height: 200px; width: 300px; overflow-y:auto"></div>
                        </div>
                        <div class="form-group"></div>
                        <div class="form-group"></div>
                        <input class="form-control" name="endqi" id="endqi" type="text" value="" style="display:none;">
                        <input class="form-control" name="end" id="endq" placeholder="End Location" type="text" value="" required>
                        <div id="result2" style="display:flex; flex-direction:column; margin:auto; z-index: 1; max-height: 200px; width: 300px; overflow-y:auto"></div>
                    </div>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                    To Be Implemented
                </div>
            </div>
        </div>
</div>

<div class="form-group">
    <input class="form-control" name="price" id="validationCustom04" placeholder="Price Per Gal" type="text" required>
</div>

<div class="form-group">
    <button class="btn btn-primary" type="submit">Calculate</button>
</div>

</form>
</div>


<script>
    // if (document.getElementsByName("start")[0].value != "" && document.getElementsByName("end")[0].value != "") {
    //     document.getElementsByName("miles")[0].value = document.getElementsByName("miles")[0].value ? document.getElementsByName(
    //         "miles")[0].value : 1
    // } else if (document.getElementsByName("miles")[0].value != "") {
    //     document.getElementsByName("start")[0].value = document.getElementsByName("start")[0].value ? document.getElementsByName(
    //         "start")[0].value : 1
    //     document.getElementsByName("end")[0].value = document.getElementsByName("end")[0].value ? document.getElementsByName(
    //         "start")[0].value : 1
    // }

    $(document).ready(function () {
        $('#startq').change(function () {
            var val1 = $("#startq").val();
            document.getElementById('result').style.display = "block";
            $.ajax({
                url: "/search",
                type: "get",
                data: {
                    val1: val1
                },
                success: function (response) {
                    result_div = ''
                    for (i = 0; i < response.result.length; i++) {
                        console.log(i)
                        // result_div += "<p class='resulted' type='button' id=" +
                        //     response.result[i][0] + " onclick=" + 'myfunc(' + response.result[
                        //         i][0] + ')' + ">" + response.result[i][1] +
                        //     "</p>"
                        result_div += "<p class='btn btn-link' id=" +
                            response.result[i][0] +
                            " onclick='myfunc(this)' style='color:black; text-decoration: none;'>" +
                            response.result[
                                i][1] +
                            "</p>"
                    }


                    $("#result").html(result_div)
                },
            });

        });
        $('#endq').change(function () {
            var val1 = $("#endq").val();
            document.getElementById('result2').style.display = "block";
            $.ajax({
                url: "/search",
                type: "get",
                data: {
                    val1: val1
                },
                success: function (response) {
                    result_div = ""

                    for (i = 0; i < response.result.length; i++) {
                        result_div += "<div class='btn btn-link' id=" +
                            response.result[i][0] +
                            " onclick='myfunc2(this)' style='color:black; text-decoration: none;'>" +
                            response.result[
                                i][1] +
                            "</div>"
                    }
                    $("#result2").html(result_div)
                },
            })
        })
    });

    function myfunc(o) {
        document.getElementById('startq').value = o.innerHTML;
        document.getElementById('startqi').value = o.id;
        document.getElementById('result').style.display = "none";
    }

    function myfunc2(o) {
        document.getElementById('endq').value = o.innerHTML;
        document.getElementById('endqi').value = o.id;
        document.getElementById('result2').style.display = "none";
    }
    // function myfunc(id) {
    //     console.log(id)
    // }


    // Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
        'use strict';
        window.addEventListener('load', function () {
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.getElementsByClassName('needs-validation');
            // Loop over them and prevent submission
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>

{% endblock %}